public class Listgrid {






























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































	public HandlerRegistration addRecordDoubleClickHandler(final RecordDoubleClickHandler handler) {
		recordDoubleClickHandlers.add(handler);
		return new HandlerRegistration() {
			@Override
			public void removeHandler() {
				recordDoubleClickHandlers.remove(handler);
			}
		};
	}

	public Set<SelectionChangedHandler> getSelectionChangedHandlers() {
		return Sets.newHashSet(selectionChangedHandlers);
	}


	public HandlerRegistration addSelectionChangedHandler(final SelectionChangedHandler handler) {
		selectionChangedHandlers.add(handler);
		return new HandlerRegistration() {
			@Override
			public void removeHandler() {
				selectionChangedHandlers.remove(handler);
			}
		};
	}

	public Set<SelectionUpdatedHandler> getSelectionUpdatedHandlers() {
		return Sets.newHashSet(selectionUpdatedHandlers);
	}


	public HandlerRegistration addSelectionUpdatedHandler(final SelectionUpdatedHandler handler) {
		selectionUpdatedHandlers.add(handler);
		return new HandlerRegistration() {
			@Override
			public void removeHandler() {
				selectionUpdatedHandlers.remove(handler);
			}
		};
	}

























































































































































































































































































































































































































































































	public ListGridRecord[] getSelectedRecords() {
		return selectedRecords;
	}



















	public SelectionEventFactory getSelectionEventFactory() {
		if (selectionEventFactory == null) {
			return selectionEventFactory = InjectorSingleton.get().getInstance(SelectionEventFactory.class);
		} else {
			return selectionEventFactory;
		}
	}

	public void setSelectionEventFactory(SelectionEventFactory selectionEventFactory) {
		this.selectionEventFactory = selectionEventFactory;
	}

	public RecordFactory getRecordFactory() {
		if (recordFactory == null) {
			return recordFactory = InjectorSingleton.get().getInstance(RecordFactory.class);
		} else {
			return recordFactory;
		}
	}

	public void setRecordFactory(RecordFactory recordFactory) {
		this.recordFactory = recordFactory;
	}









	public void setListGridRecordFactory(ListGridRecordFactory listGridRecordFactory) {
		this.listGridRecordFactory = listGridRecordFactory;
	}


	public void paintContent(PaintTarget target) throws PaintException {
		propertyPainter.paintContent(target);

		if (dataSource != null) {
			target.addAttribute("dataSource", dataSource);
		}

		if (!selectionChangedHandlers.isEmpty()) {
			target.addAttribute("*hasSelectionChangedHandlers", true);
		}

		if (!selectionUpdatedHandlers.isEmpty()) {
			target.addAttribute("*hasSelectionUpdatedHandlers", true);
		}

		if (!recordDoubleClickHandlers.isEmpty()) {
			target.addAttribute("*hasRecordDoubleClickHandlers", true);
		}

		super.paintContent(target);
	}


	public void changeVariables(Object source, Map<String, Object> variables) {
		if (variables.containsKey("selectedRecords")) {
			try {
				final JsonRootNode node = new JdomParser().parse((String) variables.get("selectedRecords"));
				selectedRecords = getListGridRecordFactory().newListGridRecords(node.getArrayNode());
			} catch (Exception e) {
				Throwables.propagate(e);
			}
		}

		if (variables.containsKey("onSelectionChanged.event")) {
			try {
				final JsonRootNode root = new JdomParser().parse((String) variables.get("onSelectionChanged.event"));
				final SelectionEvent event = getSelectionEventFactory().newSelectionEvent(root);

				for (SelectionChangedHandler handler : selectionChangedHandlers) {
					handler.onSelectionChanged(event);
				}
			} catch (Exception e) {
				Throwables.propagate(e);
			}
		}

		if (variables.containsKey("onSelectionUpdated.event")) {
			final SelectionUpdatedEvent event = new SelectionUpdatedEvent(this);

			for (SelectionUpdatedHandler handler : selectionUpdatedHandlers) {
				handler.onSelectionUpdated(event);
			}
		}

		if (variables.containsKey("onRecordDoubleClick")) {
			try {
				final JsonRootNode root = new JdomParser().parse((String) variables.get("onRecordDoubleClick.event.record"));
				final Record record = getRecordFactory().newRecord(root);
				final int recordNum = (Integer) variables.get("onRecordDoubleClick.event.recordNum");
				final ListGridField field = (ListGridField) variables.get("onRecordDoubleClick.event.field");
				final int fieldNum = (Integer) variables.get("onRecordDoubleClick.event.fieldNum");
				final RecordDoubleClickEvent event = new RecordDoubleClickEvent(this, this, record, recordNum, field, fieldNum);

				for (RecordDoubleClickHandler handler : recordDoubleClickHandlers) {
					handler.onRecordDoubleClick(event);
				}
			} catch (Exception e) {
				Throwables.propagate(e);
			}
		}

		super.changeVariables(source, variables);
	}

	protected void fireEvent(com.google.web.bindery.event.shared.Event<?> event) {
		if (event instanceof RecordDoubleClickEvent) {
			for (RecordDoubleClickHandler handler : recordDoubleClickHandlers) {
				handler.onRecordDoubleClick((RecordDoubleClickEvent) event);
			}
		}
	}
}
